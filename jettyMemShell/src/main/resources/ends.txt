{
    org.eclipse.jetty.server.HttpChannel channel = $1;
    final String target = channel.getRequest().getPathInfo();
    final org.eclipse.jetty.server.Request request = channel.getRequest();
    final org.eclipse.jetty.server.Response response = channel.getResponse();

    if (LOG.isDebugEnabled())
        LOG.debug("{} {} {} on {}", request.getDispatcherType(), request.getMethod(), target, channel);

    if (HttpMethod.OPTIONS.is(request.getMethod()) || "*".equals(target))
    {
        if (!HttpMethod.OPTIONS.is(request.getMethod()))
        {
            request.setHandled(true);
            response.sendError(HttpStatus.BAD_REQUEST_400);
        }
        else
        {
            handleOptions(request, response);
            if (!request.isHandled())
                handle(target, request, request, response);
        }
    }
    else
        handle(target, request, request, response);

    if (LOG.isDebugEnabled())
        LOG.debug("handled={} async={} committed={} on {}", request.isHandled(), request.isAsyncStarted(), response.isCommitted(), channel);
}